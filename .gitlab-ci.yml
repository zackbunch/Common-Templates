# .gitlab-ci.yml (top-level)

include:
  - local: /.gitlab/containerize.gitlab-ci.yml
  - local: /.gitlab/fetch-generic.gitlab-ci.yml
  - local: /.gitlab/job-rules.gitlab-ci.yml
  - local: /.gitlab/container-scan.gitlab-ci.yml
  - local: /.gitlab/secrets.gitlab-ci.yml
  - local: /.gitlab/promote.gitlab-ci.yml
  - local: /.gitlab/release.gitlab-ci.yml

stages: [fetch, build, scan, promote, release]

workflow:
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
    - if: $CI_COMMIT_BRANCH && $CI_OPEN_MERGE_REQUESTS
      when: never
    - if: $CI_COMMIT_BRANCH
    - if: $CI_COMMIT_TAG

# Global defaults (inherited by all jobs unless overridden)
default:
  retry:
    max: 2
    when:
      - runner_system_failure
      - stuck_or_timeout_failure
      - api_failure
  interruptible: true  # optional: cancels superseded jobs on new pipelines

variables:
  APP_NAME: syactemplates
  PUSH_FEATURE_BRANCH: "true"


fetch:my-package:
  extends: .fetch_generic_package
  variables:
    PACKAGE_NAME: "sqlcl"
    PACKAGE_VERSION: "0.0.1"
    PACKAGE_FILE: "sqlcl.tar.gz"

